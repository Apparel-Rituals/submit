index.html:

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Uniform Request Form</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    label { display: block; margin-top: 10px; }
    select, input[type="text"], input[type="number"] { width: 100%; padding: 8px; margin-top: 5px; }
    .stock-info { color: green; font-weight: bold; margin-top: 5px; }
    button { margin-top: 20px; padding: 10px 20px; }
  </style>
</head>
<body>
  <h2>Uniform Request Form</h2>
  <form id="uniformForm">
    <label>Employee Name
      <input type="text" id="empName" required />
    </label>

    <label>Employee Code
      <input type="text" id="empCode" required />
    </label>

    <label>Uniform Barcode
      <select id="barcode" required></select>
      <div class="stock-info" id="stockDisplay"></div>
    </label>

    <label>Quantity
      <input type="number" id="qty" min="1" required />
    </label>

    <label>Region
      <select id="region" required></select>
    </label>

    <label>Store
      <select id="store" required></select>
    </label>

    <button type="submit">Submit</button>
  </form>

  <div id="message"></div>

  <script>
    const stockURL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vST2H4FYdTFxPnJQq04pDiTtBA_8lDyJA_Ik7eKt6uVv9XwHTRwgs7UdoDBL_LBiJ6Iq2zZc-vK1BSx/pub?gid=901085179&single=true&output=csv';
    const scriptURL = 'https://script.google.com/macros/s/AKfycbywF8zHLDEpX0TrQT4rkAjUwiTONz4W_DjfdTjWlTmd5ode0M7tDHJkTlAt25lh1f3J/exec';
    const storeURL = 'store.json';

    let stockData = {};

    async function fetchStock() {
      const res = await fetch(stockURL);
      const csv = await res.text();
      const rows = csv.trim().split('\n').slice(1);
      const barcodeSelect = document.getElementById('barcode');
      barcodeSelect.innerHTML = '<option value="">-- Select Barcode --</option>';
      rows.forEach(row => {
        const [barcode, stock] = row.split(',');
        stockData[barcode] = parseInt(stock);
        barcodeSelect.innerHTML += `<option value="${barcode}">${barcode}</option>`;
      });
    }

    async function fetchStores() {
      const res = await fetch(storeURL);
      const storeData = await res.json();
      const regionSelect = document.getElementById('region');
      regionSelect.innerHTML = '<option value="">--Select Region--</option>';
      for (const region in storeData) {
        regionSelect.innerHTML += `<option value="${region}">${region}</option>`;
      }
      regionSelect.addEventListener('change', () => {
        const storeSelect = document.getElementById('store');
        const selectedRegion = regionSelect.value;
        storeSelect.innerHTML = '';
        if (storeData[selectedRegion]) {
          storeData[selectedRegion].forEach(store => {
            storeSelect.innerHTML += `<option value="${store}">${store}</option>`;
          });
        }
      });
    }

    document.addEventListener('DOMContentLoaded', async () => {
      await fetchStock();
      await fetchStores();

      document.getElementById('barcode').addEventListener('change', () => {
        const selected = document.getElementById('barcode').value;
        const available = stockData[selected] || 0;
        const stockDisplay = document.getElementById('stockDisplay');
        if (available === 0) {
          stockDisplay.textContent = 'Out of stock';
          stockDisplay.style.color = 'red';
        } else {
          stockDisplay.textContent = `Available: ${available}`;
          stockDisplay.style.color = 'green';
        }
      });
    });

    document.getElementById('uniformForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const barcode = document.getElementById('barcode').value;
      const qty = parseInt(document.getElementById('qty').value);
      const available = stockData[barcode] || 0;
      const message = document.getElementById('message');

      if (available === 0) {
        message.textContent = '❌ Cannot submit: Out of stock';
        message.style.color = 'red';
        return;
      }
      if (qty > available) {
        message.textContent = `❌ Cannot submit: Only ${available} left.`;
        message.style.color = 'red';
        return;
      }

      const payload = {
        empName: document.getElementById('empName').value,
        empCode: document.getElementById('empCode').value,
        barcode,
        qty,
        region: document.getElementById('region').value,
        store: document.getElementById('store').value
      };

      try {
        const res = await fetch(scriptURL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });

        const result = await res.json();
        if (result.success) {
          message.textContent = '✅ Submitted successfully';
          message.style.color = 'green';
          setTimeout(() => window.location.reload(), 1500);
        } else {
          message.textContent = '❌ Error: ' + result.message;
          message.style.color = 'red';
        }
      } catch (err) {
        console.error(err);
        message.textContent = '❌ Error submitting the form';
        message.style.color = 'red';
      }
    });
  </script>
</body>
</html>


Code.gs:

function doPost(e) {
  try {
    const data = JSON.parse(e.postData.contents);

    // your sheet logic...
    const ss = SpreadsheetApp.openById("YOUR_SHEET_ID_HERE");
    const stockSheet = ss.getSheetByName("Stock");
    const dataSheet = ss.getSheetByName("Data");

    const barcode = data.barcode;
    const qty = parseInt(data.qty, 10);

    const stockData = stockSheet.getDataRange().getValues();
    let updated = false;

    for (let i = 1; i < stockData.length; i++) {
      if (stockData[i][0] === barcode) {
        let currentStock = stockData[i][1];
        if (currentStock >= qty) {
          stockSheet.getRange(i + 1, 2).setValue(currentStock - qty);
          updated = true;
        } else {
          return ContentService
            .createTextOutput(JSON.stringify({ success: false, message: "Insufficient stock" }))
            .setMimeType(ContentService.MimeType.JSON)
            .setHeader("Access-Control-Allow-Origin", "*");
        }
        break;
      }
    }

    if (updated) {
      dataSheet.appendRow([
        new Date(),
        data.empName,
        data.empCode,
        data.barcode,
        data.qty,
        data.region,
        data.store
      ]);

      return ContentService
        .createTextOutput(JSON.stringify({ success: true }))
        .setMimeType(ContentService.MimeType.JSON)
        .setHeader("Access-Control-Allow-Origin", "*");
    } else {
      return ContentService
        .createTextOutput(JSON.stringify({ success: false, message: "Barcode not found" }))
        .setMimeType(ContentService.MimeType.JSON)
        .setHeader("Access-Control-Allow-Origin", "*");
    }

  } catch (err) {
    return ContentService
      .createTextOutput(JSON.stringify({ success: false, error: err.message }))
      .setMimeType(ContentService.MimeType.JSON)
      .setHeader("Access-Control-Allow-Origin", "*");
  }
}
function doGet(e) {
  return ContentService
    .createTextOutput("GET Request Working")
    .setMimeType(ContentService.MimeType.TEXT)
    .setHeader("Access-Control-Allow-Origin", "*");
}
